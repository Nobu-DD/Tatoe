<% content_for(:title, "#{@topic.title}") %>
<% set_meta_tags(twitter: {image: ogp_image_topic_url(@topic)})  %>
<div class="pt-5 pb-15 px-2">
  <div class="bg-white shadow-lg rounded-2xl w-full py-8 px-2 space-y-6">
    <div class="text-center mb-5">
      <h2 class=" text-2xl font-bold text-gray-800">お題詳細</h2>
    </div>
    <div id="topic_block">
      <%= render 'description', topic: @topic %>
      <!-- Answers -->
      <% if user_signed_in? %>
      <!-- ここからturbo処理 -->
      <%= turbo_frame_tag "new_answer" do %>
      <%= link_to "例えを投稿！", new_topic_answer_path(@topic), class: "block mt-4 w-full text-center bg-[#A0D8EF] hover:bg-[#7CC7E8] text-white font-medium text-xl px-4 py-2 rounded-xl" %>
      <% end %>
      <!-- ここまで -->
      <% else %>
      <%= link_to new_user_session_path(redirect_path: request.path), class: "block mt-4 w-full text-center bg-[#A0D8EF] hover:bg-[#7CC7E8] text-white font-medium text-xl px-4 py-2 rounded-xl flex flex-col" do %>
      <div class="flex items-center justify-center">
        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
        </svg>
        <span class="text-xl">例えを投稿！</span>
      </div>
      <span class=" text-sm">※ログイン画面に進みます</span>
      <% end %>
      <% end %>
      <div class="py-6">
        <div class="flex justify-between items-center mx-3">
          <h3 class="text-lg font-bold text-gray-800 mb-4">みんなの例え</h3>
          <div class="flex items-center space-x-1">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#999999">
              <path d="M240-400h480v-80H240v80Zm0-120h480v-80H240v80Zm0-120h480v-80H240v80ZM880-80 720-240H160q-33 0-56.5-23.5T80-320v-480q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v720ZM160-320h594l46 45v-525H160v480Zm0 0v-480 480Z" />
            </svg>
            <span id="answers_size" class="text-[#999999]"><%=@topic.answers_count%></span>
          </div>
        </div>
        <div class="flex justify-center">
          <%= render "shared/paginate", collection: @answers %>
        </div>
        <div id="topic_answers">
          <% if @answers.any? %>
          <% @answers.each do |answer| %>
          <div id=<%="topic_answer_#{answer.id}"%>>
            <%= render "shared/answer", answer: answer, topic: @topic, comment_button: true %>
          </div>
          <% end %>
          <% else %>
          <div id="not_answer" class="text-center py-12">
            <svg class="w-12 h-12 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M17 8h2a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2v-8a2 2 0 012-2h2m4-4h4m-4 4h4m-4 4h4" />
            </svg>
            <p class="text-gray-500">まだ例えが投稿されていません</p>
            <p class="text-sm text-gray-400">最初の例えを投稿してみませんか？</p>
          </div>
          <% end %>
        </div>
        <div class="flex justify-center">
          <%= render "shared/paginate", collection: @answers %>
        </div>
      </div>
    </div>
  </div>
</div>